<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varc.brewnetapp.domain.correspondent.query.mapper.CorrespondentMapper">

    <resultMap id="correspondentResultMap" type="com.varc.brewnetapp.domain.correspondent.query.dto.CorrespondentDTO">
        <id property="correspondentCode" column="CORRESPONDENT_CODE"/>
        <result property="correspondentName" column="CORRESPONDENT_NAME"/>
        <result property="address" column="ADDRESS"/>
        <result property="detailAddress" column="DETAIL_ADDRESS"/>
        <result property="email" column="EMAIL"/>
        <result property="contact" column="CONTACT"/>
        <result property="managerName" column="MANAGER_NAME"/>
    </resultMap>

    <!-- 거래처 목록 조회 및 검색 -->
    <select id="searchCorrespondents"
            parameterType="com.varc.brewnetapp.domain.correspondent.common.SearchCorrespondentCriteria"
            resultMap="correspondentResultMap">
        SELECT
               C.CORRESPONDENT_CODE,
               C.NAME AS CORRESPONDENT_NAME,
               C.ADDRESS,
               C.DETAIL_ADDRESS,
               C.EMAIL,
               C.CONTACT,
               C.MANAGER_NAME
          FROM TBL_CORRESPONDENT C
        <where>
            C.ACTIVE = TRUE
            <if test="correspondentCode != null">
                AND C.CORRESPONDENT_CODE = #{correspondentCode}
            </if>
            <if test="correspondentName != null">
                AND C.NAME LIKE CONCAT('%', #{correspondentName}, '%')
            </if>
        </where>
         ORDER BY C.CORRESPONDENT_CODE DESC
         LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <!-- 거래처 목록 페이지네이션을 위한 거래처 총 개수 -->
    <select id="getTotalCorrespondentCount"
            parameterType="com.varc.brewnetapp.domain.correspondent.common.SearchCorrespondentCriteria"
            resultType="int">
        SELECT
               COUNT(C.CORRESPONDENT_CODE)
          FROM TBL_CORRESPONDENT C
        <where>
            C.ACTIVE = TRUE
            <if test="correspondentCode != null">
                AND C.CORRESPONDENT_CODE = #{correspondentCode}
            </if>
            <if test="correspondentName != null">
                AND C.NAME LIKE CONCAT('%', #{correspondentName}, '%')
            </if>
        </where>
        ORDER BY C.CORRESPONDENT_CODE DESC
    </select>
</mapper>