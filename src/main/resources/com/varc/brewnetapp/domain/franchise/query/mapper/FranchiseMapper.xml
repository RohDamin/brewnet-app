<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.varc.brewnetapp.domain.franchise.query.mapper.FranchiseMapper">

  <resultMap id="franchiseResultMap" type="com.varc.brewnetapp.domain.franchise.query.dto.FranchiseDTO">
    <id property="franchiseCode" column="FRANCHISE_CODE"/>
    <result property="franchiseName" column="FRANCHISE_NAME"/>
    <result property="address" column="ADDRESS"/>
    <result property="contact" column="CONTACT"/>
    <result property="businessNumber" column="BUSINESS_NUMBER"/>
    <result property="name" column="NAME"/>
  </resultMap>

  <select id="selectFranchise" resultMap="franchiseResultMap" parameterType="_int">
    SELECT
           FRANCHISE_CODE
         , FRANCHISE_NAME
         , CONCAT (ADDRESS, ' ', DETAIL_ADDRESS) AS ADDRESS
         , CONTACT
         , BUSINESS_NUMBER
         , NAME
      FROM tbl_franchise
     WHERE ACTIVE = TRUE AND FRANCHISE_CODE = ${franchiseCode}
  </select>



  <select id="selectFranchiseList" resultMap="franchiseResultMap" parameterType="map">
    SELECT
           FRANCHISE_CODE
         , FRANCHISE_NAME
         , CONCAT (ADDRESS, ' ', DETAIL_ADDRESS) AS ADDRESS
         , CONTACT
         , BUSINESS_NUMBER
         , NAME
      FROM tbl_franchise
     WHERE ACTIVE = TRUE
    <if test="franchiseName != null and franchiseName != ''">
      AND FRANCHISE_NAME LIKE CONCAT('%', #{franchiseName}, '%')
    </if>
    <if test="citys != null and citys.size() > 0">
      AND CITY IN
      <foreach item="city" collection="citys" open="(" separator="," close=")">
        #{city}
      </foreach>
    </if>
     ORDER BY FRANCHISE_CODE DESC
     LIMIT #{ pageSize }
    OFFSET #{ offset };
  </select>

  <select id="selectFranchiseWhereFranchiseNameAndCitysCnt" resultType="_int" parameterType="map">
    SELECT
           COUNT(*)
      FROM tbl_franchise
     WHERE ACTIVE = TRUE
    <if test="franchiseName != null and franchiseName != ''">
      AND FRANCHISE_NAME LIKE CONCAT('%', #{franchiseName}, '%')
    </if>
    <if test="citys != null and citys.size() > 0">
      AND CITY IN
      <foreach item="city" collection="citys" open="(" separator="," close=")">
        #{city}
      </foreach>
    </if>
  </select>

</mapper>